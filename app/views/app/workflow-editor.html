<div ng-class="view.classes" loading="view.loading">

    <div class="heading">

        <div class="main-heading">
            <div class="workflow-name">
                <span class="pipeline-repo"> ({{ ::view.workflow['sbg:createdBy'] }}) </span>
                <span>{{ ::view.workflow.label}}</span>
            </div>

            <strong class="changes-mark" ng-if="view.isChanged" tooltip="There are changes in your workflow" tooltip-placement="right">
                (<i class="fa fa-asterisk"></i>)
            </strong>

            <div class="actions pull-right">

                <button class="btn btn-default" ng-click="editMetadata()" ng-disabled="view.saving" ><i class="fa fa-pencil"></i> Metadata</button>
                <button ng-if="view.user" ng-click="save()" class="btn btn-default" ng-disabled="view.saving">
                    <i class="fa fa-save"></i>
                   Save
                </button>
                <button class="btn btn-default" ng-click="runWorkflow()" ng-disabled="view.saving" ><i class="fa fa-play"></i> Run</button>

                <div class="btn-group right" ng-class="{open: view.isMenuOpen}">
                    <button type="button" ng-click="toggleMenu()" class="btn btn-default dropdown-toggle">
                        <i class="fa fa-cog"></i>
                        <span class="caret"></span>
                    </button>

                    <ul class="dropdown-menu" role="menu" ng-click="toggleMenu()">

                        <li ng-if="view.user && view.mode === 'edit'">
                            <a href='' ng-click="validateWorkflowJSON()" ng-disabled="view.saving" ><i class="fa fa-check"></i> Validate</a>
                        </li>
                        <li ng-if="view.user && view.mode === 'edit'">
                            <a a href='' ng-click="workflowToJSON()" ng-disabled="view.saving" ><i class="fa fa-code"></i> JSON</a>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
    <!-- # .heading -->

    <div ng-if="!view.loading" class="content content-tbl flex-box-row">

        <div class="col flex-box-column flex-one content-col">
            <div class="pipeline-wrap flex-box-column flex-one" pipeline="view.workflow" edit-mode="true" controller-id="view.id" pipeline-change-fn="onWorkflowChange(value)"></div>
        </div>

        <div class="col flex-box-column flex-auto sidebar-col" ng-class="{closed: !view.showSidebar}">

            <div class="heading no-padding">
                <ul class="nav nav-tabs nav-tabs-steps">

                    <li class="toggle-action">
                        <a href ng-click="toggleSidebar()">
                            <i ng-class="{'fa-chevron-right': view.showSidebar, 'fa-chevron-left': !view.showSidebar}" class="fa"></i>
                        </a>
                    </li>

                    <li ng-class="{active: view.tab === 'apps'}"><a href ng-click="switchTab('apps')">Apps</a></li>
                    <li ng-class="{active: view.tab === 'params'}"><a href ng-click="switchTab('params')">Params</a></li>
                    <!--<li ng-class="{active: view.tab === 'properties'}"><a href ng-click="switchTab('properties')">Properties</a></li>-->
                </ul>
            </div>

            <div class="content content-tbl flex-box-column">

                <div class="tabs right flex-one" ng-switch="view.tab">

                    <div class="tab flex-box-column flex-one" ng-class="{loading: view.filtering}" ng-switch-when="apps">

                        <ul class="app-sidebar-list">

                            <li ng-repeat="(repoType, repoTypeObj) in view.repoTypes" ng-class="{open: view.groups[repoType]}">

                                <span ng-click="toggleGroup(repoType)">
                                    <i class="fa" ng-class="{'fa-plus-square': !view.groups[repoType], 'fa-minus-square': view.groups[repoType]}"></i>
                                    {{ ::view.capitalize(repoType)}}
                                </span>

                                <ul>
                                    <li ng-if="(repoTypeObj | isEmpty)">
                                        <p class="alert alert-info">
                                            <span ng-if="repoType === 'MyApps' && !view.user"> {{ view.message }}</span>
                                            <span ng-if="repoType === 'MyApps' && view.user">You don't have any apps yet</span>
                                            <span ng-if="repoType === 'PublicApps'">There are no public apps</span>
                                        </p>
                                    </li>
                                    <li ng-repeat="(repoName, apps) in repoTypeObj" ng-class="{open: view.repoGroups[repoName]}">

                                        <span ng-click="toggleRepo(repoName)">
                                            <i class="fa" ng-class="{'fa-plus-square': !view.repoGroups[repoName], 'fa-minus-square': view.repoGroups[repoName]}"></i>
                                            {{ ::repoName }}
                                        </span>

                                        <ul class="apps-inner-list">
                                            <li ng-if="apps.length !== 0"><span class="label label-info section-name">Apps</span></li>

                                            <li ng-repeat="app in ::apps">

                                                <a href drag="app">
                                                    <i class="fa fa-puzzle-piece"></i>
                                                    {{ ::app.label }} <small>(type: {{ ::app.type }} )</small>
                                                    <div class="pull-right">
                                                        <span class="label label-primary"><i class="fa fa-tag"></i> v{{ ::app['sbg:revision'] }} </span>
                                                    </div>
                                                </a>
                                            </li>

                                        </ul>

                                    </li>
                                </ul>


                            </li>

                        </ul>

                    </div>

                    <div class="tab flex-one" ng-switch-when="params">
                        <p class="alert alert-info" ng-if="view.json | isEmpty">Select node in order to change its parameters</p>

                        <form ng-if="!(view.json | isEmpty)" class="form" name="paramForms" novalidate>

                            <h3 class="tab-title">{{ ::view.json.label }}</h3>

                            <input-field
                                    ng-repeat="property in view.json.inputs track by property['@id']"
                                    ng-model="view.values[view.json.id][property['@id']]"
                                    class="input-field input-field-sm"
                                    key="@id"
                                    prop="property"
                                    form="form.jobForm"
                                    app-name="{{ ::view.json.id }}"
                                    exposed="view.exposed"
                                    ignore-files="true"
                                    handle-expose="onExpose(appName, property['@id'])">
                            </input-field>

                            <p class="alert alert-info" ng-if="view.json.inputs.length === 0">There are no params that can be exposed.</p>
                        </form>

                    </div>

                    <div class="tab flex-one" ng-switch-when="properties">
                        <h3>Properties</h3>
                    </div>

                </div>
            </div>

        </div>


    </div>

</div>